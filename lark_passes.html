<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="All the passes in this module are based on Lark.">

<title>Spannerlib - Lark Passes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Spannerlib - Lark Passes">
<meta property="og:description" content="All the passes in this module are based on Lark.">
<meta property="og:site_name" content="Spannerlib">
<meta name="twitter:title" content="Spannerlib - Lark Passes">
<meta name="twitter:description" content="All the passes in this module are based on Lark.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Spannerlib</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">src</li><li class="breadcrumb-item"><a href="./expected_grammar.html">Grammar &amp; Parsing</a></li><li class="breadcrumb-item"><a href="./lark_passes.html">Lark Passes</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Spannerlib</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stdlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard library ie functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advanced_usage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./building_your_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building your own optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extended_version.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced IE functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./covid-nlp/covid_pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Covid-19 NLP Pipeline</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">src</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Generic</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./general_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General Utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./primitive_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Primitive Types</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Grammar &amp; Parsing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./expected_grammar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Expected Grammar</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./symbol_table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Symbol Table</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lark_passes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lark Passes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./passes_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Passes Utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizations_passes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimizations Passes</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Engine</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./engine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Engine</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./execution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Execution</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Graphs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ast_node_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ast Nodes Types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ie_function.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IE Function</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graphs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./adding_inference_rules_to_term_graph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adding inference rules to term graph</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">User-Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  </ul></li>
  <li><a href="#pass-types" id="toc-pass-types" class="nav-link" data-scroll-target="#pass-types">Pass Types</a>
  <ul class="collapse">
  <li><a href="#transformer" id="toc-transformer" class="nav-link" data-scroll-target="#transformer">1. Transformer</a></li>
  <li><a href="#visitor-visitor_recursive" id="toc-visitor-visitor_recursive" class="nav-link" data-scroll-target="#visitor-visitor_recursive">2. Visitor / Visitor_Recursive</a></li>
  <li><a href="#interpreter" id="toc-interpreter" class="nav-link" data-scroll-target="#interpreter">3. Interpreter</a></li>
  </ul></li>
  <li><a href="#learning-resources" id="toc-learning-resources" class="nav-link" data-scroll-target="#learning-resources">Learning Resources</a>
  <ul class="collapse">
  <li><a href="#genericpass" id="toc-genericpass" class="nav-link" data-scroll-target="#genericpass">GenericPass</a></li>
  <li><a href="#visitorpass" id="toc-visitorpass" class="nav-link" data-scroll-target="#visitorpass">VisitorPass</a></li>
  <li><a href="#visitorrecursivepass" id="toc-visitorrecursivepass" class="nav-link" data-scroll-target="#visitorrecursivepass">VisitorRecursivePass</a></li>
  <li><a href="#interpreterpass" id="toc-interpreterpass" class="nav-link" data-scroll-target="#interpreterpass">InterpreterPass</a></li>
  <li><a href="#transformerpass" id="toc-transformerpass" class="nav-link" data-scroll-target="#transformerpass">TransformerPass</a></li>
  <li><a href="#removetokens" id="toc-removetokens" class="nav-link" data-scroll-target="#removetokens">RemoveTokens</a></li>
  <li><a href="#checkreservedrelationnames" id="toc-checkreservedrelationnames" class="nav-link" data-scroll-target="#checkreservedrelationnames">CheckReservedRelationNames</a></li>
  <li><a href="#fixstrings" id="toc-fixstrings" class="nav-link" data-scroll-target="#fixstrings">FixStrings</a></li>
  <li><a href="#convertspannodestospaninstances" id="toc-convertspannodestospaninstances" class="nav-link" data-scroll-target="#convertspannodestospaninstances">ConvertSpanNodesToSpanInstances</a></li>
  <li><a href="#convertstatementstostructurednodes" id="toc-convertstatementstostructurednodes" class="nav-link" data-scroll-target="#convertstatementstostructurednodes">ConvertStatementsToStructuredNodes</a></li>
  <li><a href="#checkdefinedreferencedvariables" id="toc-checkdefinedreferencedvariables" class="nav-link" data-scroll-target="#checkdefinedreferencedvariables">CheckDefinedReferencedVariables</a></li>
  <li><a href="#checkreferencedrelationsexistenceandarity" id="toc-checkreferencedrelationsexistenceandarity" class="nav-link" data-scroll-target="#checkreferencedrelationsexistenceandarity">CheckReferencedRelationsExistenceAndArity</a></li>
  <li><a href="#checkreferencedierelationsexistenceandarity" id="toc-checkreferencedierelationsexistenceandarity" class="nav-link" data-scroll-target="#checkreferencedierelationsexistenceandarity">CheckReferencedIERelationsExistenceAndArity</a></li>
  <li><a href="#checkrulesafety" id="toc-checkrulesafety" class="nav-link" data-scroll-target="#checkrulesafety">CheckRuleSafety</a></li>
  <li><a href="#rule-safety-conditions" id="toc-rule-safety-conditions" class="nav-link" data-scroll-target="#rule-safety-conditions">Rule Safety Conditions</a></li>
  <li><a href="#free-variable-in-rule-head" id="toc-free-variable-in-rule-head" class="nav-link" data-scroll-target="#free-variable-in-rule-head">1. Free Variable in Rule Head</a></li>
  <li><a href="#bound-free-variable" id="toc-bound-free-variable" class="nav-link" data-scroll-target="#bound-free-variable">2. Bound Free Variable</a></li>
  <li><a href="#safe-relations" id="toc-safe-relations" class="nav-link" data-scroll-target="#safe-relations">Safe Relations</a></li>
  <li><a href="#typecheckassignments" id="toc-typecheckassignments" class="nav-link" data-scroll-target="#typecheckassignments">TypeCheckAssignments</a></li>
  <li><a href="#typecheckrelations" id="toc-typecheckrelations" class="nav-link" data-scroll-target="#typecheckrelations">TypeCheckRelations</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  <li><a href="#semantic-checks" id="toc-semantic-checks" class="nav-link" data-scroll-target="#semantic-checks">Semantic Checks</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#savedeclaredrelationsschemas" id="toc-savedeclaredrelationsschemas" class="nav-link" data-scroll-target="#savedeclaredrelationsschemas">SaveDeclaredRelationsSchemas</a></li>
  <li><a href="#resolvevariablesreferences" id="toc-resolvevariablesreferences" class="nav-link" data-scroll-target="#resolvevariablesreferences">ResolveVariablesReferences</a></li>
  <li><a href="#executeassignments" id="toc-executeassignments" class="nav-link" data-scroll-target="#executeassignments">ExecuteAssignments</a></li>
  <li><a href="#addstatementstonetxparsegraph" id="toc-addstatementstonetxparsegraph" class="nav-link" data-scroll-target="#addstatementstonetxparsegraph">AddStatementsToNetxParseGraph</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/DeanLight/spannerlib/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">src</li><li class="breadcrumb-item"><a href="./expected_grammar.html">Grammar &amp; Parsing</a></li><li class="breadcrumb-item"><a href="./lark_passes.html">Lark Passes</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Lark Passes</h1>
</div>

<div>
  <div class="description">
    All the passes in this module are based on <code>Lark</code>.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<section id="table-of-contents" class="level3">
<h3 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h3>
<ol type="1">
<li><a href="#pass-types">Pass Types</a></li>
<li><a href="#learning-resources">Learning Resources</a></li>
</ol>
<hr>
</section>
</section>
<section id="pass-types" class="level2">
<h2 class="anchored" data-anchor-id="pass-types">Pass Types</h2>
<p>The engine module incorporates three primary types of passes:</p>
<section id="transformer" class="level3">
<h3 class="anchored" data-anchor-id="transformer">1. Transformer</h3>
<p>Takes a Lark tree as an input and returns a completely new Lark tree. The order in which the nodes are visited can be user-defined.</p>
</section>
<section id="visitor-visitor_recursive" class="level3">
<h3 class="anchored" data-anchor-id="visitor-visitor_recursive">2. Visitor / Visitor_Recursive</h3>
<p>Takes a Lark tree as input and modifies it in-place, if at all. The visitation order is not defined, making this class suitable for cases where nodes are visited without requiring specific context. <code>Visitor_Recursive</code> is often the choice for efficiency, as per the documentation.</p>
</section>
<section id="interpreter" class="level3">
<h3 class="anchored" data-anchor-id="interpreter">3. Interpreter</h3>
<p>Functions similarly to the <code>Visitor</code> class, but with a defined order for visiting nodes. By default, nodes are visited in breadth-first search (BFS) order from the root of the Lark tree.</p>
<hr>
</section>
</section>
<section id="learning-resources" class="level2">
<h2 class="anchored" data-anchor-id="learning-resources">Learning Resources</h2>
<p>For those interested in diving deeper into Lark, the following resources are recommended:</p>
<ul>
<li><strong>Official Documentation</strong>: <a href="https://lark-parser.readthedocs.io/en/stable/">Lark Documentation</a></li>
<li><strong>Cheat Sheet</strong>: <a href="https://lark-parser.readthedocs.io/en/stable/lark_cheatsheet.pdf">Lark Cheat Sheet</a></li>
<li><strong>Tutorial</strong>: <a href="https://github.com/lark-parser/lark/blob/master/docs/json_tutorial.md">Lark Tutorial on JSON Parsing</a></li>
</ul>
<hr>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L35" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="genericpass" class="level3">
<h3 class="anchored" data-anchor-id="genericpass">GenericPass</h3>
<blockquote class="blockquote">
<pre><code> GenericPass ()</code></pre>
</blockquote>
<p><em>Helper class that provides a standard way to create an ABC using inheritance.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L41" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="visitorpass" class="level3">
<h3 class="anchored" data-anchor-id="visitorpass">VisitorPass</h3>
<blockquote class="blockquote">
<pre><code> VisitorPass ()</code></pre>
</blockquote>
<p>*Tree visitor, non-recursive (can handle huge trees).</p>
<p>Visiting a node calls its methods (provided by the user via inheritance) according to <code>tree.data</code>*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L46" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="visitorrecursivepass" class="level3">
<h3 class="anchored" data-anchor-id="visitorrecursivepass">VisitorRecursivePass</h3>
<blockquote class="blockquote">
<pre><code> VisitorRecursivePass ()</code></pre>
</blockquote>
<p>*Bottom-up visitor, recursive.</p>
<p>Visiting a node calls its methods (provided by the user via inheritance) according to <code>tree.data</code></p>
<p>Slightly faster than the non-recursive version.*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L51" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="interpreterpass" class="level3">
<h3 class="anchored" data-anchor-id="interpreterpass">InterpreterPass</h3>
<blockquote class="blockquote">
<pre><code> InterpreterPass ()</code></pre>
</blockquote>
<p>*Interpreter walks the tree starting at the root.</p>
<p>Visits the tree, starting with the root and finally the leaves (top-down)</p>
<p>For each tree node, it calls its methods (provided by user via inheritance) according to <code>tree.data</code>.</p>
<p>Unlike <code>Transformer</code> and <code>Visitor</code>, the Interpreter doesn’t automatically visit its sub-branches. The user has to explicitly call <code>visit</code>, <code>visit_children</code>, or use the <code>@visit_children_decor</code>. This allows the user to implement branching and loops.*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L56" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="transformerpass" class="level3">
<h3 class="anchored" data-anchor-id="transformerpass">TransformerPass</h3>
<blockquote class="blockquote">
<pre><code> TransformerPass (visit_tokens=True)</code></pre>
</blockquote>
<p>*Transformers visit each node of the tree, and run the appropriate method on it according to the node’s data.</p>
<p>Methods are provided by the user via inheritance, and called according to <code>tree.data</code>. The returned value from each method replaces the node in the tree structure.</p>
<p>Transformers work bottom-up (or depth-first), starting with the leaves and ending at the root of the tree. Transformers can be used to implement map &amp; reduce patterns. Because nodes are reduced from leaf to root, at any point the callbacks may assume the children have already been transformed (if applicable).</p>
<p><code>Transformer</code> can do anything <code>Visitor</code> can do, but because it reconstructs the tree, it is slightly less efficient.</p>
<p>All these classes implement the transformer interface:</p>
<ul>
<li><code>Transformer</code> - Recursively transforms the tree. This is the one you probably want.</li>
<li><code>Transformer_InPlace</code> - Non-recursive. Changes the tree in-place instead of returning new instances</li>
<li><code>Transformer_InPlaceRecursive</code> - Recursive. Changes the tree in-place instead of returning new instances</li>
</ul>
<p>Parameters: visit_tokens (bool, optional): Should the transformer visit tokens in addition to rules. Setting this to <code>False</code> is slightly faster. Defaults to <code>True</code>. (For processing ignored tokens, use the <code>lexer_callbacks</code> options)</p>
<p>NOTE: A transformer without methods essentially performs a non-memoized partial deepcopy.*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L61" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="removetokens" class="level3">
<h3 class="anchored" data-anchor-id="removetokens">RemoveTokens</h3>
<blockquote class="blockquote">
<pre><code> RemoveTokens (**kw:Any)</code></pre>
</blockquote>
<p><em>A lark pass that should be used before the semantic checks. <br> Transforms the lark tree by removing the redundant tokens. <br></em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L96" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="checkreservedrelationnames" class="level3">
<h3 class="anchored" data-anchor-id="checkreservedrelationnames">CheckReservedRelationNames</h3>
<blockquote class="blockquote">
<pre><code> CheckReservedRelationNames (**kw:Any)</code></pre>
</blockquote>
<p><em>A lark tree semantic check. Checks if there are relations in the program with a name that starts with <code>RESERVED_RELATION_PREFIX</code> if such relations exist, throw an exception as this is a reserved name for spannerlog.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L116" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fixstrings" class="level3">
<h3 class="anchored" data-anchor-id="fixstrings">FixStrings</h3>
<blockquote class="blockquote">
<pre><code> FixStrings (**kw:Any)</code></pre>
</blockquote>
<p><em>Fixes the strings in the lark tree. <br> Removes the line overflow escapes from strings.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L137" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="convertspannodestospaninstances" class="level3">
<h3 class="anchored" data-anchor-id="convertspannodestospaninstances">ConvertSpanNodesToSpanInstances</h3>
<blockquote class="blockquote">
<pre><code> ConvertSpanNodesToSpanInstances (**kw:Any)</code></pre>
</blockquote>
<p><em>Converts each span node in the ast to a span instance. <br> This means that a span in the tree will be represented by a single value (a <code>DataTypes.Span</code> instance) instead of two integer nodes, making it easier to work with (as other data types are also represented by a single value).</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L159" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="convertstatementstostructurednodes" class="level3">
<h3 class="anchored" data-anchor-id="convertstatementstostructurednodes">ConvertStatementsToStructuredNodes</h3>
<blockquote class="blockquote">
<pre><code> ConvertStatementsToStructuredNodes (**kw:Any)</code></pre>
</blockquote>
<p><em>converts each statement node in the tree to a structured node, making it easier to parse in future passes. <br> a structured node is a class representation of a node in the abstract syntax tree. <br></em></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>note that after using this pass, non statement nodes will no longer appear in the tree, so passes that should work on said nodes need to be used before this pass in the passes pipeline (e.g.&nbsp;<code>FixString</code>).</p>
</div>
</div>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L350" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="checkdefinedreferencedvariables" class="level3">
<h3 class="anchored" data-anchor-id="checkdefinedreferencedvariables">CheckDefinedReferencedVariables</h3>
<blockquote class="blockquote">
<pre><code> CheckDefinedReferencedVariables (symbol_table:SymbolTableBase, **kw:Any)</code></pre>
</blockquote>
<p><em>A lark tree semantic check. <br> checks whether each variable reference refers to a defined variable.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L426" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="checkreferencedrelationsexistenceandarity" class="level3">
<h3 class="anchored" data-anchor-id="checkreferencedrelationsexistenceandarity">CheckReferencedRelationsExistenceAndArity</h3>
<blockquote class="blockquote">
<pre><code> CheckReferencedRelationsExistenceAndArity (symbol_table:SymbolTableBase,
                                            **kw:Any)</code></pre>
</blockquote>
<p><em>A lark tree semantic check. <br> Checks whether each normal relation (that is not an ie relation) reference refers to a defined relation. Also checks if the relation reference uses the correct arity.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L493" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="checkreferencedierelationsexistenceandarity" class="level3">
<h3 class="anchored" data-anchor-id="checkreferencedierelationsexistenceandarity">CheckReferencedIERelationsExistenceAndArity</h3>
<blockquote class="blockquote">
<pre><code> CheckReferencedIERelationsExistenceAndArity
                                              (symbol_table:SymbolTableBas
                                              e, **kw:Any)</code></pre>
</blockquote>
<p>*A lark tree semantic check. <br> Checks whether each ie relation reference refers to a defined ie function. <br> Also checks if the correct input arity and output arity for the ie function were used.</p>
<p>Currently, an ie relation can only be found in a rule’s body, so this is the only place where this check will be performed.*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L540" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="checkrulesafety" class="level3">
<h3 class="anchored" data-anchor-id="checkrulesafety">CheckRuleSafety</h3>
<blockquote class="blockquote">
<pre><code> CheckRuleSafety (**kw:Any)</code></pre>
</blockquote>
<p>*Performs semantic checks on rules using a Lark tree to ensure their safety. <br> A rule is considered “safe” when it meets certain conditions.</p>
<ul>
<li><a href="#rule-safety-conditions">Rule Safety Conditions</a>
<ul>
<li><a href="#free-variable-in-rule-head">Free Variable in Rule Head</a></li>
<li><a href="#bound-free-variable">Bound Free Variable</a></li>
</ul></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#safe-relations">Safe Relations</a></li>
</ul>
<hr>
</section>
<section id="rule-safety-conditions" class="level3">
<h3 class="anchored" data-anchor-id="rule-safety-conditions">Rule Safety Conditions</h3>
<p>For a rule to be considered safe, the following two conditions must be met:</p>
</section>
<section id="free-variable-in-rule-head" class="level3">
<h3 class="anchored" data-anchor-id="free-variable-in-rule-head">1. Free Variable in Rule Head</h3>
<p>Every free variable that appears in the rule head must occur at least once in the body as an output term of a relation.</p>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples</h4>
<ul>
<li><code>parent(X,Y) &lt;- son(X)</code> is not a safe rule because the free variable <code>Y</code> only appears in the rule head.<br>
</li>
<li><code>parent(X,Z) &lt;- parent(X,Y), parent(Y,Z)</code> is a safe rule since both <code>X</code> and <code>Z</code> appear in the rule body.</li>
</ul>
</section>
</section>
<section id="bound-free-variable" class="level3">
<h3 class="anchored" data-anchor-id="bound-free-variable">2. Bound Free Variable</h3>
<p>A free variable is considered “bound” if it is constrained in a manner that limits the range of values it can take.</p>
<p>To ensure that every free variable is bound, we must ensure that every relation in the rule body is a safe relation.</p>
</section>
<section id="safe-relations" class="level3">
<h3 class="anchored" data-anchor-id="safe-relations">Safe Relations</h3>
<p>A safe relation adheres to the following:</p>
<ul>
<li>Its input relation is safe, meaning all its input’s free variables are bound. Normal relations are always considered safe as they don’t have input relations.<br>
</li>
<li>A bound variable is one that exists in the output of a safe relation.</li>
</ul>
<section id="examples-1" class="level4">
<h4 class="anchored" data-anchor-id="examples-1">Examples</h4>
<ul>
<li><code>rel2(X,Y) &lt;- rel1(X,Z), ie1&lt;X&gt;(Y)</code> is a safe rule as the only input free variable, <code>X</code>, exists in the output of the safe relation <code>rel1(X, Z)</code>.<br>
</li>
<li><code>rel2(Y) &lt;- ie1&lt;Z&gt;(Y)</code> is not safe as the input free variable <code>Z</code> does not exist in the output of any safe relation.</li>
</ul>
<p>—*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L677" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="typecheckassignments" class="level3">
<h3 class="anchored" data-anchor-id="typecheckassignments">TypeCheckAssignments</h3>
<blockquote class="blockquote">
<pre><code> TypeCheckAssignments (symbol_table:SymbolTableBase, **kw:Any)</code></pre>
</blockquote>
<p><em>A lark semantic check <br> performs type checking for <code>Assignments</code> <br> in the current version of lark, this type checking is only required for read assignments.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L705" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="typecheckrelations" class="level3">
<h3 class="anchored" data-anchor-id="typecheckrelations">TypeCheckRelations</h3>
<blockquote class="blockquote">
<pre><code> TypeCheckRelations (symbol_table:SymbolTableBase, **kw:Any)</code></pre>
</blockquote>
<p>*A Lark Tree Semantic Check</p>
</section>
<section id="assumptions" class="level3">
<h3 class="anchored" data-anchor-id="assumptions">Assumptions</h3>
<p>This pass operates under the following assumptions. Failure to meet these may lead to incorrect results:</p>
<ol type="1">
<li>References to relations and IE (Information Extraction) relations, as well as their arity, have been properly checked.</li>
<li>Variable references have been verified.</li>
<li>The pass only processes a single statement as input.</li>
</ol>
</section>
<section id="semantic-checks" class="level3">
<h3 class="anchored" data-anchor-id="semantic-checks">Semantic Checks</h3>
<p>The pass performs the following specific checks:</p>
<section id="typed-relation-references" class="level4">
<h4 class="anchored" data-anchor-id="typed-relation-references">1. Typed Relation References</h4>
<p>It verifies if the relation references in the rule are correctly typed.</p>
</section>
<section id="typed-ie-relations" class="level4">
<h4 class="anchored" data-anchor-id="typed-ie-relations">2. Typed IE Relations</h4>
<p>It verifies if the IE relations in the rule are correctly typed.</p>
</section>
<section id="conflicting-types-in-free-variables" class="level4">
<h4 class="anchored" data-anchor-id="conflicting-types-in-free-variables">3. Conflicting Types in Free Variables</h4>
<p>Checks if free variables within rules have conflicting types. This is crucial to ensure that the rules are logically coherent.</p>
</section>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>Here is an example that illustrates how a semantic check may fail on the third type of check:</p>
<p><code>prolog new A(str) new B(int) C(X) &lt;- A(X), B(X)  # Error: X is expected to be both an int and a string.</code>*</p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L789" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="savedeclaredrelationsschemas" class="level3">
<h3 class="anchored" data-anchor-id="savedeclaredrelationsschemas">SaveDeclaredRelationsSchemas</h3>
<blockquote class="blockquote">
<pre><code> SaveDeclaredRelationsSchemas (symbol_table:SymbolTableBase, **kw:Any)</code></pre>
</blockquote>
<p><em>This pass writes the relation schemas that it finds in relation declarations and rule heads</em> to the symbol table.</p>
<p>This pass assumes that type checking was already performed on its input.*</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that a rule is a relation declaration of the rule head relation and a definition of its contents</p>
</div>
</div>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L822" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="resolvevariablesreferences" class="level3">
<h3 class="anchored" data-anchor-id="resolvevariablesreferences">ResolveVariablesReferences</h3>
<blockquote class="blockquote">
<pre><code> ResolveVariablesReferences (symbol_table:SymbolTableBase, **kw:Any)</code></pre>
</blockquote>
<p><em>A lark execution pass, <br> this pass replaces variable references with their literal values. <br> also replaces <code>DataTypes.var_name</code> types with the real type of the variable.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L904" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="executeassignments" class="level3">
<h3 class="anchored" data-anchor-id="executeassignments">ExecuteAssignments</h3>
<blockquote class="blockquote">
<pre><code> ExecuteAssignments (symbol_table:SymbolTableBase, **kw:Any)</code></pre>
</blockquote>
<p><em>A lark execution pass, <br> executes assignments by saving variables’ values and types in the symbol table <br> should be used only after variable references are resolved, meaning the assigned values and read() arguments are guaranteed to be literals.</em></p>
<hr>
<p><a href="https://github.com/DeanLight/spannerlib/blob/master/spannerlib/lark_passes.py#L935" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="addstatementstonetxparsegraph" class="level3">
<h3 class="anchored" data-anchor-id="addstatementstonetxparsegraph">AddStatementsToNetxParseGraph</h3>
<blockquote class="blockquote">
<pre><code> AddStatementsToNetxParseGraph (parse_graph:NetxStateGraph, **kw:Any)</code></pre>
</blockquote>
<p>*A lark execution pass. <br> This pass adds each statement in the input parse tree to the parse graph. <br> This pass is made to work with execution.naive_execution as the execution function and <code>term_graph.NetxStateGraph</code> as the parse graph.</p>
<p>Each statement in the parse graph will be a child of the parse graph’s root.</p>
<p>Each statement in the parse graph will have a type attribute that contains the statement’s name in the spannerlog grammar.</p>
<p>Some nodes in the parse graph will contain a value attribute that would contain a relation that describes that statement. e.g.&nbsp;a <a href="https://DeanLight.github.io/spannerlib/engine.html#add_fact"><code>add_fact</code></a> node would have a value which is a <code>structured_nodes.AddFact</code> instance (which inherits from <code>structured_nodes.Relation</code>) that describes the fact that will be added.</p>
<p>Some statements are more complex and will be described by more than a single node, e.g.&nbsp;a rule node. The reason for this is that we want a single netx node to not contain more than one Relation (or <a href="https://DeanLight.github.io/spannerlib/ast_node_types.html#ierelation"><code>IERelation</code></a>) instance. This will make the parse graph a “graph of relation nodes”, allowing for flexibility for optimization in the future.*</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/DeanLight\.github\.io\/spannerlib");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/DeanLight/spannerlib/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>